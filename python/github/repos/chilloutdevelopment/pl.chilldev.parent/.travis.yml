##
# This file is part of the ChillDev-Parent.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2015 - 2018 Â© by Rafal Wrzeszcz - Wrzasq.pl.
##

#FIXME: https://github.com/travis-ci/travis-ci/issues/753

language: "java"

sudo: false

dist: "trusty"

branches:
    except:
        - "/^release-/"

jdk:
    - "openjdk8"
    - "oraclejdk8"
    - "oraclejdk9"
    - "openjdk10"
    - "openjdk11"
    - "oraclejdk11"

env:
    global:
        -
            secure: |-
                nUTnQ8WmKYbyWCkBAzO7UVqIZYCbWdoiV9IHigAbhsVgk2RzSjMVEzY/9dOp+YZnmXZ40Z2VZBNNMWEI2lYXQiX3joMP6reIBNoq+tc
                etrt9MO5fSEP9h4Sc4NA19L5zrUI1q8WgO+JeRIR38dvB11vCVzipkLFMjmP0bm4yX3/rDcsoG0QKs/8LDXEYreYpAxPKTuX1VKmqz6
                9Tp2fEFSFmUtkkZBXxOgDTjlN/BivrD+sCITcOb+LXiwqxij4KM7+aOoAPpdMjPhUpJDKFnKp5MKzVZAK9tpdU7gg1c7PLhQgslBBCD
                3pan6yXTPZdUhxJTb1YLFXDOTI0Vor+PIEl9MRQT0q9TR6S+lLU82P5JXbz7l1lxeazU2nHpaVOAygKzLftz6YVEk4a+h7+QGeTH8xH
                kmd4UknAMxjz00XVzshGuRvpi+mC+MIFDNXS/xqm0H9nBNC3b/X6kZU9zl6rtiVnfh9UxTpjTUxpUs8mfkOAK0qMoBawuhOHXgFFmEu
                CTULcfRHqS948X2qeAspJiW/FOFw7By+jVhA6byiW1GNRbdmTdxY9T7x7g3eLWEjgA+3vXF4D6f0cse3od6YGmMDBeqKyWu89o7nurA
                nTmGAGLXykZA2X3jTyidXuDgzIRzN1DYk/OcltgsIFtF+ZMLU2mEmfRNR6va2fC7M=
        -
            secure: |-
                ZaIZealJvoudZBTYCoF4tl6b6zpqBiLePXzzKUSx39Kk5qGseM7aUF5xbTxw0T3DNvfxSFM8QAuL7GNau1E4FOvhF32DmJU6r0iteTm
                53JPMr58kOZTxEIWNY4oOUPlfDkvVqxqzwmIsY2RdY4Q+k2rx4eAdcZzG9LVoY5wkFmmcWqObqEJQ0ogGDvcKvBWxaVluCTMuTMjg52
                ezFrMcojK26Tgp2VckeXIuoKP/I/cCX6ID4Tqe5O2tHbxesgEpsHUHaJCoxlOTlY5AldvUks4yL+32i/mMQIuYiQtDr1ARod8tPZHIB
                Unlxrm4Hi9e9O3v5r5YAg29HKBE1olaBgbnwOewRyaNdFxr1F2xYogU/ZoHQRnnXn1GUj0Mczd5VSYuXVc3HwBh+4N8IN6zTFzBYYai
                tiL5y48mBMhbOReerCNBIhYQZGabY24mMfK7mgBGQyrexkeynNqeJieH0XxWiUMKN7QHsWTFqiBPAek71vNKxU/1Er/QDNIjBoZfqF7
                eX/tJwLI0W4s1l/HJcjb2ZEe0S/ZN9YaWeET58WUMJ3Vb0+VJDinW5/7BvIT8QHTOo6G12E2jEjARya/2kA20iVrYGfGYu5ty3RYC1U
                ZyZNJGFPQHp2NtVkPwyc8U2y3fV4jKrJSuaQdCVOzwdFqgCSLRRzkpPyBQ/9s1kOo=
        -
            secure: |-
                gfp/p6MSq1MRY4Oc1M53/efEJeLxC77BMFUu10NN6ktSI4REKytcnmkk6oRzNH5YnJvn+1zVS6saLZWFuTTRcxUEuv2ePekp3gS6G06
                FG3GyHN3I5Z7LVFWxBiG/OSrOPDM1pHKXZ2kFVtSEgcJliNSOej09ORerJBH41vd1UTboyQsqrAtBNIO+FTf4EW3cypXFRsgiMlPecK
                XNLqRJtMJM+qqgmPbtt1rwk9DGJrHIArpOT6UwZ7toXpGc53aNCyxEUe9vPQbX7Zg12RFgBoe1zJngoN6f2/LWVLan7rwWPVWAH+KRf
                Rl5nOEVRD4264pnnjuyDTpc9OBSZVzyYMs1/MUv4HZ9gQvk1Gvr9FtpVGNq/f95mZ9RADG4R5HOTvG54tfy/qCeDGOPpAJOVfj3+KD/
                CwUY21X5RvoXpuuJ6VbiLR90Iwdg71RI6YSlQxnLi8Hm4kNs9rDeK2TR9Um+1DBZnT8s138gLKL7iWsueG+Efd58C0H30vlZJSyKuG3
                t+o8SqSnQra6YQh7h2Dyy01l3qrob88AaGDxZ0oTHLG7AafYdIGh5VRftrD0bdLBuWNCRQUSEH+7Ez/pz3ZCfV3D9CJJuou6IQCXFPd
                Ck7jzV/Addt7lPKEWHqoAWCkP8o7WrChGZhmEtYgVCJwv0M/hkV1eA1I2hK2y2ZO0=
        -
            secure: |-
                vUKNC86PPURYPtV9OvMgC1GHjKbpc8am9kmTZOjqq3zqhLeX8YC2M7ey1rNuWQozEPk4VfRBFlChu4GUyzOspZJU0IQLCXOb90QkSQ5
                xr60bopFHUSrN25goe5JIiCbOuMdGKf/Qi4Sp+aX2rEM60NTPXu+ylOMmYfLpWIQUMjgFCZc2kbLaA1BHeqUoMsfBaklqxy7LUr5N41
                53vX6ycNEVOaECNRlSMpB3TLZbyXbL4r7ZyfNDwx1IoKOtIvFb3zQhe8MTsZ9qE8wgSzYyet4qn9f5wh3/PK+0w/q87EajcYn2z1ZKD
                xzopibwuC93Ix/guI3TDA54HgQucF+RKPiQmsG3HIveqczUhvaivawcaot9JjPH0RanlUPSmJxUZgHatLxCB5ugJf5NrmbIvlPrdJHA
                fs3Bg6jv31VuzZ1vT+MxzmEOERZKntwrP2AaR6JeMX3zYLhOWCURILle5FxogPwzdTbwPtt0mKZG9uL8RNzPOt5Fuu2mpbntqKoJ6O2
                SFzIrNHubenv74uOc2xV598xpcAZmhV53FmjrT5/IYhlmUBF1MAu337RElPBdTHf3BQXPTJmdG+VZGYVO5yF3XyWj4sKlEmsn4bafON
                ZOZm21kYdkjYDO2HlniN4APXQV/1a9f1+lTJBo5fKHc/jdLr8hfS7DCQPfr/ZBfCI=
        -
            secure: |-
                DFCRyhp5M58AOF+483xBQxPE1bMKQznmoYW6yyKrJVCi/NZEMkeayUsm6McAUIq8yvaEAJe3i0XAnFkvL+cF34vEo/9usqZX5//+6mb
                GoHCx6ks+wBHyLvsnqtGPPbBqLPhd2DSG5qPDYXLEOXkb/hqFuioDsmF+NyLEWkDjewMdHAqExLhl1z/gCtjQVRLMopJsujVTglCRBG
                AaiuUp/ophG4RLUWyVYSoAmbuwxeT/YSBEixbTRrKy7vU662HrKiLfhZxiklo0tWWJwkghct7iz+I8g0r/tMVylh5kLhJmEe25QXL4Y
                VD3TL2YCCjAdpdthKHmVRe4id20pyy7pTJuPaMHNtHZb9nkdE2V07SohEjaNWtz7qvNVk1HTenIfggXzd77KasBkoXB3lZEBNpMNNMy
                C5euWcShBVgSRP7Tt2fhTJkYfNX2EfOq+PFBYDpi61cMqkrn6kgIaq1dgWRpFAaFOKAT9HuWWStlbWalcRCtA4ESDKDRntrB6qAkkL+
                eI54U6Zb+rOE/XdI213g6Kg6hZdAj9nIWG42Uj2hs0eSILOMrYe1fGCN2dYOYj6d1iTw4o7g52jwW69594kI+/e6OP2u7O7Ag+Er4Pq
                6vntdaSJ+Jc1MzaEIMNW9xxXUag7nqiZqGzIlxmROVQwuxXzp8jqVl5ceILW7oGEQ=

# this is not a boolean, this is a Linux `true` command to simply override this step
install: "true"

script: "mvn -e verify site"

after_script: "mvn -e coveralls:report"

before_deploy:
    - "eval \"$(ssh-agent -s)\""
    - "git config user.name \"Travis CI\""
    - "git config user.email \"office@chilldev.pl\""
    - "openssl aes-256-cbc -md sha256 -k \"${SECRET}\" -in .travis/gpg_key.enc -out .travis/gpg_key -d"
    - "openssl aes-256-cbc -md sha256 -k \"${SECRET}\" -in .travis/id_rsa.enc -out .travis/id_rsa -d"
    # this is needed to avoid duplicated key error as we have two deploys on `master`
    - "rm -f ~/.gnupg/*.gpg"
    - "gpg --fast-import .travis/gpg_key"
    - "chmod 600 .travis/id_rsa"
    - "ssh-add .travis/id_rsa"
    - "echo -e \"Host github.com\\n    StrictHostKeyChecking no\\n\" >> ~/.ssh/config"

deploy:
    -
        provider: "script"
        skip_cleanup: true
        # unfortunately deploy script must be single command
        script: "./.travis/release.sh"
        on:
            branch: "develop"
            condition: "${TRAVIS_EVENT_TYPE} == push"
            jdk: "oraclejdk8"
    -
        provider: "script"
        skip_cleanup: true
        script: "mvn -e deploy site-deploy -P deploy --settings .travis/settings.xml"
        on:
            branch: "master"
            jdk: "oraclejdk8"
    -
        provider: "releases"
        skip_cleanup: true
        api_key: "${GITHUB_TOKEN}"
        file_glob: true
        file: "*/target/*.jar"
        on:
            branch: "master"
            jdk: "oraclejdk8"

cache:
    directories:
        - "${HOME}/.m2/"

before_cache: "rm -rf ${HOME}/.m2/repository/pl/chilldev/parent"

notifications:
    webhooks:
        urls:
            - "https://webhooks.gitter.im/e/42cfb538d50215e50977"
