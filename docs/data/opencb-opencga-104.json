{
    "project_name": "opencb-opencga",
    "error_id": "104",
    "information": {
        "errors": [
            {
                "line": "312",
                "severity": "error",
                "message": "Line is longer than 140 characters (found 144).",
                "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
            }
        ]
    },
    "source_code": "                try {\n                    VariantScoreFormatDescriptor formatDescriptor = new VariantScoreFormatDescriptor(1, 16, 15);\n                    variantStorageManager.variantScoreLoad(study, outputFile.toUri(), indexScoreId, caseCohort, controlCohort, formatDescriptor,\n                            executorParams, token);\n                } catch (CatalogException | StorageEngineException e) {\n                    throw new ToolException(e);",
    "results": [
        {
            "tool": "styler",
            "errors": [
                {
                    "line": "312",
                    "severity": "error",
                    "message": "Line is longer than 140 characters (found 144).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                }
            ],
            "diff": "",
            "diff_size": 0
        },
        {
            "tool": "intellij",
            "errors": [],
            "diff": "diff --git a/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/errored/1/104/GwasAnalysis.java b/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/intellij/104/GwasAnalysis.java\nindex b8d52ffdd39..823bf664344 100644\n--- a/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/errored/1/104/GwasAnalysis.java\n+++ b/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/intellij/104/GwasAnalysis.java\n@@ -41,391 +41,393 @@ import java.util.*;\n import java.util.stream.Collectors;\n \n @Tool(id = GwasAnalysis.ID, type = ToolType.VARIANT,\n-        description = GwasAnalysis.DESCRIPTION)\n+    description = GwasAnalysis.DESCRIPTION)\n public class GwasAnalysis extends OpenCgaTool {\n \n-    public static final String ID = \"gwas\";\n-    public static final String DESCRIPTION = \"Run a Genome Wide Association Study between two cohorts.\";\n-\n-    private GwasConfiguration gwasConfiguration = new GwasConfiguration();\n-    private String study;\n-    private String phenotype;\n-    private String caseCohort;\n-    private String controlCohort;\n-    private Query caseCohortSamplesQuery;\n-    private Query controlCohortSamplesQuery;\n-    private List<String> caseCohortSamples;\n-    private List<String> controlCohortSamples;\n-    private String indexScoreId;\n-    private boolean index;\n-    private Path outputFile;\n-\n-    public GwasAnalysis() {\n+  public static final String ID = \"gwas\";\n+  public static final String DESCRIPTION = \"Run a Genome Wide Association Study between two cohorts.\";\n+\n+  private GwasConfiguration gwasConfiguration = new GwasConfiguration();\n+  private String study;\n+  private String phenotype;\n+  private String caseCohort;\n+  private String controlCohort;\n+  private Query caseCohortSamplesQuery;\n+  private Query controlCohortSamplesQuery;\n+  private List<String> caseCohortSamples;\n+  private List<String> controlCohortSamples;\n+  private String indexScoreId;\n+  private boolean index;\n+  private Path outputFile;\n+\n+  public GwasAnalysis() {\n+  }\n+\n+  /**\n+   * Provide the GWAS analysis configuration.\n+   *\n+   * @param gwasConfiguration configuration\n+   * @return this\n+   */\n+  public GwasAnalysis setGwasConfiguration(GwasConfiguration gwasConfiguration) {\n+    this.gwasConfiguration = gwasConfiguration;\n+    return this;\n+  }\n+\n+  public GwasAnalysis setGwasMethod(GwasConfiguration.Method method) {\n+    this.gwasConfiguration.setMethod(method);\n+    return this;\n+  }\n+\n+  public GwasAnalysis setFisherMode(GwasConfiguration.FisherMode fisherMode) {\n+    this.gwasConfiguration.setFisherMode(fisherMode);\n+    return this;\n+  }\n+\n+  /**\n+   * Study of the samples.\n+   *\n+   * @param study Study id\n+   * @return this\n+   */\n+  public GwasAnalysis setStudy(String study) {\n+    this.study = study;\n+    return this;\n+  }\n+\n+  /**\n+   * Use this phenotype to divide all the samples from the study.\n+   * Samples with the phenotype will be used as Case Cohort. Rest will be used as Control Cohort.\n+   * <p>\n+   * This parameter can not be mixed with other parameters to define the cohorts.\n+   *\n+   * @param phenotype phenotype\n+   * @return this\n+   */\n+  public GwasAnalysis setPhenotype(String phenotype) {\n+    this.phenotype = phenotype;\n+    return this;\n+  }\n+\n+  /**\n+   * Samples query selecting samples of the case cohort.\n+   * This parameter is an alternative to {@link #setCaseCohort}\n+   *\n+   * @param caseCohortSamplesQuery sample query\n+   * @return this\n+   */\n+  public GwasAnalysis setCaseCohortSamplesQuery(Query caseCohortSamplesQuery) {\n+    this.caseCohortSamplesQuery = caseCohortSamplesQuery;\n+    return this;\n+  }\n+\n+  /**\n+   * Samples query selecting samples of the control cohort.\n+   * This parameter is an alternative to {@link #setControlCohort}\n+   *\n+   * @param controlCohortSamplesQuery sample query\n+   * @return this\n+   */\n+  public GwasAnalysis setControlCohortSamplesQuery(Query controlCohortSamplesQuery) {\n+    this.controlCohortSamplesQuery = controlCohortSamplesQuery;\n+    return this;\n+  }\n+\n+  /**\n+   * Cohort from catalog to be used as case cohort.\n+   * This parameter is an alternative to {@link #setCaseCohortSamplesQuery}\n+   *\n+   * @param caseCohort cohort name\n+   * @return this\n+   */\n+  public GwasAnalysis setCaseCohort(String caseCohort) {\n+    this.caseCohort = caseCohort;\n+    return this;\n+  }\n+\n+  /**\n+   * Cohort from catalog to be used as control cohort.\n+   * This parameter is an alternative to {@link #setControlCohortSamplesQuery}\n+   *\n+   * @param controlCohort cohort name\n+   * @return this\n+   */\n+  public GwasAnalysis setControlCohort(String controlCohort) {\n+    this.controlCohort = controlCohort;\n+    return this;\n+  }\n+\n+  public GwasAnalysis setCaseCohortSamples(List<String> caseCohortSamples) {\n+    this.caseCohortSamples = caseCohortSamples;\n+    return this;\n+  }\n+\n+  public GwasAnalysis setControlCohortSamples(List<String> controlCohortSamples) {\n+    this.controlCohortSamples = controlCohortSamples;\n+    return this;\n+  }\n+\n+  /**\n+   * Index the produced gwas score in the variant storage.\n+   *\n+   * @param index index gwas score\n+   * @return this\n+   */\n+  public GwasAnalysis setIndex(boolean index) {\n+    this.index = index;\n+    return this;\n+  }\n+\n+  /**\n+   * Name to be used to index the score in the variant storage.\n+   * Must be unique in the study. If provided, the control/case cohorts must be registered in catalog.\n+   *\n+   * @param indexScoreId score id\n+   * @return this\n+   */\n+  public GwasAnalysis setIndexScoreId(String indexScoreId) {\n+    this.indexScoreId = indexScoreId;\n+    return this;\n+  }\n+\n+  @Override\n+  protected void check() throws Exception {\n+    super.check();\n+    setUpStorageEngineExecutor(study);\n+\n+    if (gwasConfiguration == null) {\n+      gwasConfiguration = new GwasConfiguration()\n+          .setMethod(GwasConfiguration.Method.FISHER_TEST)\n+          .setFisherMode(GwasConfiguration.FisherMode.TWO_SIDED);\n     }\n \n-    /**\n-     * Provide the GWAS analysis configuration.\n-     * @param gwasConfiguration configuration\n-     * @return this\n-     */\n-    public GwasAnalysis setGwasConfiguration(GwasConfiguration gwasConfiguration) {\n-        this.gwasConfiguration = gwasConfiguration;\n-        return this;\n+    if (StringUtils.isEmpty(study)) {\n+      throw new ToolException(\"Missing study!\");\n     }\n \n-    public GwasAnalysis setGwasMethod(GwasConfiguration.Method method) {\n-        this.gwasConfiguration.setMethod(method);\n-        return this;\n+    try {\n+      study = catalogManager.getStudyManager().get(study, null, token).first().getFqn();\n+    } catch (CatalogException e) {\n+      throw new ToolException(e);\n     }\n \n-    public GwasAnalysis setFisherMode(GwasConfiguration.FisherMode fisherMode) {\n-        this.gwasConfiguration.setFisherMode(fisherMode);\n-        return this;\n-    }\n-\n-    /**\n-     * Study of the samples.\n-     * @param study Study id\n-     * @return this\n-     */\n-    public GwasAnalysis setStudy(String study) {\n-        this.study = study;\n-        return this;\n-    }\n-\n-    /**\n-     * Use this phenotype to divide all the samples from the study.\n-     * Samples with the phenotype will be used as Case Cohort. Rest will be used as Control Cohort.\n-     *\n-     * This parameter can not be mixed with other parameters to define the cohorts.\n-     *\n-     * @param phenotype phenotype\n-     * @return this\n-     */\n-    public GwasAnalysis setPhenotype(String phenotype) {\n-        this.phenotype = phenotype;\n-        return this;\n-    }\n-\n-    /**\n-     * Samples query selecting samples of the case cohort.\n-     * This parameter is an alternative to {@link #setCaseCohort}\n-     *\n-     * @param caseCohortSamplesQuery sample query\n-     * @return this\n-     */\n-    public GwasAnalysis setCaseCohortSamplesQuery(Query caseCohortSamplesQuery) {\n-        this.caseCohortSamplesQuery = caseCohortSamplesQuery;\n-        return this;\n-    }\n-\n-    /**\n-     * Samples query selecting samples of the control cohort.\n-     * This parameter is an alternative to {@link #setControlCohort}\n-     *\n-     * @param controlCohortSamplesQuery sample query\n-     * @return this\n-     */\n-    public GwasAnalysis setControlCohortSamplesQuery(Query controlCohortSamplesQuery) {\n-        this.controlCohortSamplesQuery = controlCohortSamplesQuery;\n-        return this;\n-    }\n-\n-    /**\n-     * Cohort from catalog to be used as case cohort.\n-     * This parameter is an alternative to {@link #setCaseCohortSamplesQuery}\n-     *\n-     * @param caseCohort cohort name\n-     * @return this\n-     */\n-    public GwasAnalysis setCaseCohort(String caseCohort) {\n-        this.caseCohort = caseCohort;\n-        return this;\n-    }\n+    caseCohortSamples = getCohortSamples(caseCohortSamples, caseCohort, caseCohortSamplesQuery, \"case\", true);\n+    controlCohortSamples = getCohortSamples(controlCohortSamples, controlCohort, controlCohortSamplesQuery, \"control\", false);\n \n-    /**\n-     * Cohort from catalog to be used as control cohort.\n-     * This parameter is an alternative to {@link #setControlCohortSamplesQuery}\n-     *\n-     * @param controlCohort cohort name\n-     * @return this\n-     */\n-    public GwasAnalysis setControlCohort(String controlCohort) {\n-        this.controlCohort = controlCohort;\n-        return this;\n+    if (!Collections.disjoint(caseCohortSamples, controlCohortSamples)) {\n+      List<String> overlapping = new ArrayList<>();\n+      for (String caseCohortSample : caseCohortSamples) {\n+        if (controlCohortSamples.contains(caseCohortSample)) {\n+          overlapping.add(caseCohortSample);\n+        }\n+      }\n+      throw new ToolException(\"Unable to run Gwas analysis with overlapping cohorts. \"\n+          + (overlapping.size() < 10\n+          ? \"Samples \" + overlapping + \" are shared between both cohorts.\"\n+          : \"There are \" + overlapping.size() + \" overlapping samples between the cohorts.\"));\n     }\n \n-    public GwasAnalysis setCaseCohortSamples(List<String> caseCohortSamples) {\n-        this.caseCohortSamples = caseCohortSamples;\n-        return this;\n+    // check read permission\n+    try {\n+      List<String> allSamples = new ArrayList<>();\n+      allSamples.addAll(caseCohortSamples);\n+      allSamples.addAll(controlCohortSamples);\n+      variantStorageManager.checkQueryPermissions(\n+          new Query()\n+              .append(VariantQueryParam.STUDY.key(), study)\n+              .append(VariantQueryParam.INCLUDE_SAMPLE.key(), allSamples),\n+          new QueryOptions(),\n+          token);\n+    } catch (CatalogException | StorageEngineException e) {\n+      throw new ToolException(e);\n     }\n \n-    public GwasAnalysis setControlCohortSamples(List<String> controlCohortSamples) {\n-        this.controlCohortSamples = controlCohortSamples;\n-        return this;\n-    }\n+    if (index) {\n+      if (StringUtils.isEmpty(indexScoreId)) {\n+        throw new ToolException(\"Unable to index gwas result as VariantScore. Required a valid index score id\");\n+      }\n+      if (StringUtils.isEmpty(caseCohort) || StringUtils.isEmpty(controlCohort)) {\n+        throw new ToolException(\"Unable to index gwas result as VariantScore if the cohorts are not defined in catalog\");\n+      }\n+\n+      // check score is not already indexed\n+      try {\n+        List<VariantScoreMetadata> scores = variantStorageManager.listVariantScores(study, token);\n+        for (VariantScoreMetadata score : scores) {\n+          if (score.getName().equals(indexScoreId)) {\n+            if (score.getIndexStatus().equals(TaskMetadata.Status.READY)) {\n+              throw new ToolException(\"Score name '\" + indexScoreId + \"' already exists in the database. \"\n+                  + \"The score name must be unique. Existing scores: \"\n+                  + scores.stream().map(StudyResourceMetadata::getName).collect(Collectors.toList()));\n+            }\n+          }\n+        }\n+      } catch (CatalogException | StorageEngineException e) {\n+        throw new ToolException(e);\n+      }\n \n-    /**\n-     * Index the produced gwas score in the variant storage.\n-     *\n-     * @param index index gwas score\n-     * @return this\n-     */\n-    public GwasAnalysis setIndex(boolean index) {\n-        this.index = index;\n-        return this;\n+      // TODO: Check score index permissions\n+    } else if (StringUtils.isNotEmpty(indexScoreId)) {\n+      throw new ToolException(\"Provided indexScoreId with index=false. Use index=true and indexScoreId to index the score.\");\n     }\n \n-    /**\n-     * Name to be used to index the score in the variant storage.\n-     * Must be unique in the study. If provided, the control/case cohorts must be registered in catalog.\n-     *\n-     * @param indexScoreId score id\n-     * @return this\n-     */\n-    public GwasAnalysis setIndexScoreId(String indexScoreId) {\n-        this.indexScoreId = indexScoreId;\n-        return this;\n+    outputFile = getOutDir().resolve(buildOutputFilename());\n+\n+    executorParams.append(\"index\", index)\n+        .append(\"phenotype\", phenotype)\n+        .append(\"indexScoreId\", indexScoreId)\n+        .append(\"caseCohort\", caseCohort)\n+        .append(\"caseCohortSamples\", caseCohortSamples)\n+        .append(\"controlCohort\", controlCohort)\n+        .append(\"controlCohortSamples\", controlCohortSamples);\n+  }\n+\n+  @Override\n+  protected List<String> getSteps() {\n+    List<String> steps = super.getSteps();\n+    if (index) {\n+      steps.add(\"index\");\n     }\n+    return steps;\n+  }\n \n-    @Override\n-    protected void check() throws Exception {\n-        super.check();\n-        setUpStorageEngineExecutor(study);\n-\n-        if (gwasConfiguration == null) {\n-            gwasConfiguration = new GwasConfiguration()\n-                    .setMethod(GwasConfiguration.Method.FISHER_TEST)\n-                    .setFisherMode(GwasConfiguration.FisherMode.TWO_SIDED);\n-        }\n-\n-        if (StringUtils.isEmpty(study)) {\n-            throw new ToolException(\"Missing study!\");\n-        }\n+  @Override\n+  protected void run() throws ToolException {\n \n-        try {\n-            study = catalogManager.getStudyManager().get(study, null, token).first().getFqn();\n-        } catch (CatalogException e) {\n-            throw new ToolException(e);\n-        }\n+    step(\"gwas\", () -> {\n+      GwasAnalysisExecutor gwasExecutor = getToolExecutor(GwasAnalysisExecutor.class);\n \n-        caseCohortSamples = getCohortSamples(caseCohortSamples, caseCohort, caseCohortSamplesQuery, \"case\", true);\n-        controlCohortSamples = getCohortSamples(controlCohortSamples, controlCohort, controlCohortSamplesQuery, \"control\", false);\n+      gwasExecutor.setConfiguration(gwasConfiguration)\n+          .setStudy(study)\n+          .setSampleList1(caseCohortSamples)\n+          .setSampleList2(controlCohortSamples)\n+          .setOutputFile(outputFile)\n+          .execute();\n+    });\n \n-        if (!Collections.disjoint(caseCohortSamples, controlCohortSamples)) {\n-            List<String> overlapping = new ArrayList<>();\n-            for (String caseCohortSample : caseCohortSamples) {\n-                if (controlCohortSamples.contains(caseCohortSample)) {\n-                    overlapping.add(caseCohortSample);\n-                }\n-            }\n-            throw new ToolException(\"Unable to run Gwas analysis with overlapping cohorts. \"\n-                    + (overlapping.size() < 10\n-                        ? \"Samples \" + overlapping + \" are shared between both cohorts.\"\n-                        : \"There are \" + overlapping.size() + \" overlapping samples between the cohorts.\"));\n-        }\n+//        step(\"manhattan-plot\", this::createManhattanPlot);\n \n-        // check read permission\n+    if (index) {\n+      step(\"index\", () -> {\n         try {\n-            List<String> allSamples = new ArrayList<>();\n-            allSamples.addAll(caseCohortSamples);\n-            allSamples.addAll(controlCohortSamples);\n-            variantStorageManager.checkQueryPermissions(\n-                    new Query()\n-                            .append(VariantQueryParam.STUDY.key(), study)\n-                            .append(VariantQueryParam.INCLUDE_SAMPLE.key(), allSamples),\n-                    new QueryOptions(),\n-                    token);\n+          VariantScoreFormatDescriptor formatDescriptor = new VariantScoreFormatDescriptor(1, 16, 15);\n+          variantStorageManager.variantScoreLoad(study, outputFile.toUri(), indexScoreId, caseCohort, controlCohort, formatDescriptor,\n+              executorParams, token);\n         } catch (CatalogException | StorageEngineException e) {\n-            throw new ToolException(e);\n-        }\n-\n-        if (index) {\n-            if (StringUtils.isEmpty(indexScoreId)) {\n-                throw new ToolException(\"Unable to index gwas result as VariantScore. Required a valid index score id\");\n-            }\n-            if (StringUtils.isEmpty(caseCohort) || StringUtils.isEmpty(controlCohort)) {\n-                throw new ToolException(\"Unable to index gwas result as VariantScore if the cohorts are not defined in catalog\");\n-            }\n-\n-            // check score is not already indexed\n-            try {\n-                List<VariantScoreMetadata> scores = variantStorageManager.listVariantScores(study, token);\n-                for (VariantScoreMetadata score : scores) {\n-                    if (score.getName().equals(indexScoreId)) {\n-                        if (score.getIndexStatus().equals(TaskMetadata.Status.READY)) {\n-                            throw new ToolException(\"Score name '\" + indexScoreId + \"' already exists in the database. \"\n-                                    + \"The score name must be unique. Existing scores: \"\n-                                    + scores.stream().map(StudyResourceMetadata::getName).collect(Collectors.toList()));\n-                        }\n-                    }\n-                }\n-            } catch (CatalogException | StorageEngineException e) {\n-                throw new ToolException(e);\n-            }\n-\n-            // TODO: Check score index permissions\n-        } else if (StringUtils.isNotEmpty(indexScoreId)) {\n-            throw new ToolException(\"Provided indexScoreId with index=false. Use index=true and indexScoreId to index the score.\");\n+          throw new ToolException(e);\n         }\n-\n-        outputFile = getOutDir().resolve(buildOutputFilename());\n-\n-        executorParams.append(\"index\", index)\n-                .append(\"phenotype\", phenotype)\n-                .append(\"indexScoreId\", indexScoreId)\n-                .append(\"caseCohort\", caseCohort)\n-                .append(\"caseCohortSamples\", caseCohortSamples)\n-                .append(\"controlCohort\", controlCohort)\n-                .append(\"controlCohortSamples\", controlCohortSamples);\n+      });\n     }\n-\n-    @Override\n-    protected List<String> getSteps() {\n-        List<String> steps = super.getSteps();\n-        if (index) {\n-            steps.add(\"index\");\n-        }\n-        return steps;\n+  }\n+\n+  private void createManhattanPlot() throws ToolException {\n+  }\n+\n+  protected String buildOutputFilename() throws ToolException {\n+    GwasConfiguration.Method method = gwasConfiguration.getMethod();\n+    switch (method) {\n+      case CHI_SQUARE_TEST:\n+      case FISHER_TEST:\n+        return method.label + \".tsv.gz\";\n+      default:\n+        throw new ToolException(\"Unknown GWAS method: \" + method);\n     }\n-\n-    @Override\n-    protected void run() throws ToolException {\n-\n-        step(\"gwas\", () -> {\n-            GwasAnalysisExecutor gwasExecutor = getToolExecutor(GwasAnalysisExecutor.class);\n-\n-            gwasExecutor.setConfiguration(gwasConfiguration)\n-                    .setStudy(study)\n-                    .setSampleList1(caseCohortSamples)\n-                    .setSampleList2(controlCohortSamples)\n-                    .setOutputFile(outputFile)\n-                    .execute();\n-        });\n-\n-//        step(\"manhattan-plot\", this::createManhattanPlot);\n-\n-        if (index) {\n-            step(\"index\", () -> {\n-                try {\n-                    VariantScoreFormatDescriptor formatDescriptor = new VariantScoreFormatDescriptor(1, 16, 15);\n-                    variantStorageManager.variantScoreLoad(study, outputFile.toUri(), indexScoreId, caseCohort, controlCohort, formatDescriptor,\n-                            executorParams, token);\n-                } catch (CatalogException | StorageEngineException e) {\n-                    throw new ToolException(e);\n+  }\n+\n+  private List<String> getCohortSamples(List<String> inputSamples, String cohort, Query samplesQuery, String cohortType,\n+                                        boolean observedPhenotype)\n+      throws ToolException {\n+    boolean validListOfSamples = inputSamples != null && !inputSamples.isEmpty();\n+    boolean validSampleQuery = samplesQuery != null && !samplesQuery.isEmpty();\n+    boolean validCohort = StringUtils.isNotEmpty(cohort);\n+    boolean validPhenotype = StringUtils.isNotEmpty(phenotype);\n+    checkParamsCombination(cohortType, validListOfSamples, validSampleQuery, validCohort, validPhenotype);\n+\n+    List<String> samples;\n+    try {\n+      if (validListOfSamples) {\n+        samples = inputSamples;\n+      } else if (validPhenotype) {\n+        Set<Phenotype.Status> expectedStatus = observedPhenotype\n+            ? Collections.singleton(Phenotype.Status.OBSERVED)\n+            : new HashSet<>(Arrays.asList(null, Phenotype.Status.NOT_OBSERVED));\n+        Query query;\n+        if (observedPhenotype) {\n+          query = new Query(SampleDBAdaptor.QueryParams.PHENOTYPES_NAME.key(), phenotype);\n+        } else {\n+          // If not observed, fetch all samples, and filter manually.\n+          query = new Query();\n+        }\n+        QueryOptions options = new QueryOptions(\n+            QueryOptions.INCLUDE, Arrays.asList(\n+            SampleDBAdaptor.QueryParams.ID.key(),\n+            SampleDBAdaptor.QueryParams.PHENOTYPES.key()));\n+\n+        samples = new ArrayList<>();\n+        catalogManager.getSampleManager()\n+            .iterator(study, query, options, token)\n+            .forEachRemaining(sample -> {\n+              Phenotype.Status status = null;\n+              for (Phenotype p : sample.getPhenotypes()) {\n+                if (p.getId().equals(phenotype) || p.getName().equals(phenotype)) {\n+                  status = p.getStatus();\n                 }\n+              }\n+              if (expectedStatus.contains(status)) {\n+                samples.add(sample.getId());\n+              }\n             });\n-        }\n+      } else if (validCohort) {\n+        samples = catalogManager.getCohortManager()\n+            .get(study, cohort, new QueryOptions(), token)\n+            .first()\n+            .getSamples()\n+            .stream()\n+            .map(Sample::getId)\n+            .collect(Collectors.toList());\n+      } else {\n+        samples = catalogManager.getSampleManager()\n+            .search(study, samplesQuery, new QueryOptions(QueryOptions.INCLUDE, \"id\"), token)\n+            .getResults()\n+            .stream()\n+            .map(Sample::getId)\n+            .collect(Collectors.toList());\n+      }\n+\n+      // Remove non-indexed samples\n+      Set<String> indexedSamples = variantStorageManager.getIndexedSamples(study, token);\n+      samples.removeIf(s -> !indexedSamples.contains(s));\n+    } catch (CatalogException e) {\n+      throw new ToolException(e);\n     }\n-\n-    private void createManhattanPlot() throws ToolException {\n+    if (samples.size() <= 1) {\n+      throw new ToolException(\"Unable to run GWAS analysis with \" + cohortType + \" cohort of size \" + samples.size());\n     }\n-\n-    protected String buildOutputFilename() throws ToolException {\n-        GwasConfiguration.Method method = gwasConfiguration.getMethod();\n-        switch (method) {\n-            case CHI_SQUARE_TEST:\n-            case FISHER_TEST:\n-                return method.label + \".tsv.gz\";\n-            default:\n-                throw new ToolException(\"Unknown GWAS method: \" + method);\n-        }\n+    return samples;\n+  }\n+\n+  private void checkParamsCombination(String cohortType,\n+                                      boolean validListOfSamples, boolean validSampleQuery, boolean validCohort, boolean validPhenotype)\n+      throws ToolException {\n+    LinkedList<String> params = new LinkedList<>();\n+    if (validListOfSamples) {\n+      params.add(cohortType + \"CohortSamples\");\n     }\n-\n-    private List<String> getCohortSamples(List<String> inputSamples, String cohort, Query samplesQuery, String cohortType,\n-                                          boolean observedPhenotype)\n-            throws ToolException {\n-        boolean validListOfSamples = inputSamples != null && !inputSamples.isEmpty();\n-        boolean validSampleQuery = samplesQuery != null && !samplesQuery.isEmpty();\n-        boolean validCohort = StringUtils.isNotEmpty(cohort);\n-        boolean validPhenotype = StringUtils.isNotEmpty(phenotype);\n-        checkParamsCombination(cohortType, validListOfSamples, validSampleQuery, validCohort, validPhenotype);\n-\n-        List<String> samples;\n-        try {\n-            if (validListOfSamples) {\n-                samples = inputSamples;\n-            } else if (validPhenotype) {\n-                Set<Phenotype.Status> expectedStatus = observedPhenotype\n-                        ? Collections.singleton(Phenotype.Status.OBSERVED)\n-                        : new HashSet<>(Arrays.asList(null, Phenotype.Status.NOT_OBSERVED));\n-                Query query;\n-                if (observedPhenotype) {\n-                    query = new Query(SampleDBAdaptor.QueryParams.PHENOTYPES_NAME.key(), phenotype);\n-                } else {\n-                    // If not observed, fetch all samples, and filter manually.\n-                    query = new Query();\n-                }\n-                QueryOptions options = new QueryOptions(\n-                        QueryOptions.INCLUDE, Arrays.asList(\n-                        SampleDBAdaptor.QueryParams.ID.key(),\n-                        SampleDBAdaptor.QueryParams.PHENOTYPES.key()));\n-\n-                samples = new ArrayList<>();\n-                catalogManager.getSampleManager()\n-                        .iterator(study, query, options, token)\n-                        .forEachRemaining(sample -> {\n-                            Phenotype.Status status = null;\n-                            for (Phenotype p : sample.getPhenotypes()) {\n-                                if (p.getId().equals(phenotype) || p.getName().equals(phenotype)) {\n-                                    status = p.getStatus();\n-                                }\n-                            }\n-                            if (expectedStatus.contains(status)) {\n-                                samples.add(sample.getId());\n-                            }\n-                        });\n-            } else if (validCohort) {\n-                samples = catalogManager.getCohortManager()\n-                        .get(study, cohort, new QueryOptions(), token)\n-                        .first()\n-                        .getSamples()\n-                        .stream()\n-                        .map(Sample::getId)\n-                        .collect(Collectors.toList());\n-            } else {\n-                samples = catalogManager.getSampleManager()\n-                        .search(study, samplesQuery, new QueryOptions(QueryOptions.INCLUDE, \"id\"), token)\n-                        .getResults()\n-                        .stream()\n-                        .map(Sample::getId)\n-                        .collect(Collectors.toList());\n-            }\n-\n-            // Remove non-indexed samples\n-            Set<String> indexedSamples = variantStorageManager.getIndexedSamples(study, token);\n-            samples.removeIf(s -> !indexedSamples.contains(s));\n-        } catch (CatalogException e) {\n-            throw new ToolException(e);\n-        }\n-        if (samples.size() <= 1) {\n-            throw new ToolException(\"Unable to run GWAS analysis with \" + cohortType + \" cohort of size \" + samples.size());\n-        }\n-        return samples;\n+    if (validSampleQuery) {\n+      params.add(cohortType + \"CohortSampleQuery\");\n     }\n-\n-    private void checkParamsCombination(String cohortType,\n-                                        boolean validListOfSamples, boolean validSampleQuery, boolean validCohort, boolean validPhenotype)\n-            throws ToolException {\n-        LinkedList<String> params = new LinkedList<>();\n-        if (validListOfSamples) {\n-            params.add(cohortType + \"CohortSamples\");\n-        }\n-        if (validSampleQuery) {\n-            params.add(cohortType + \"CohortSampleQuery\");\n-        }\n-        if (validCohort) {\n-            params.add(cohortType + \"Cohort\");\n-        }\n-        if (validPhenotype) {\n-            params.add(\"Phenotype\");\n-        }\n-        if (params.isEmpty()) {\n-            throw new ToolException(\"Missing \" + cohortType + \" cohort!\");\n-        } else if (params.size() > 1) {\n-            throw new ToolException(\"Unable to mix params \" + params + \" to define the \" + cohortType + \" cohort. \"\n-                    + \"Please, provide only one of them.\");\n-        }\n+    if (validCohort) {\n+      params.add(cohortType + \"Cohort\");\n+    }\n+    if (validPhenotype) {\n+      params.add(\"Phenotype\");\n+    }\n+    if (params.isEmpty()) {\n+      throw new ToolException(\"Missing \" + cohortType + \" cohort!\");\n+    } else if (params.size() > 1) {\n+      throw new ToolException(\"Unable to mix params \" + params + \" to define the \" + cohortType + \" cohort. \"\n+          + \"Please, provide only one of them.\");\n     }\n+  }\n \n }\n",
            "diff_size": 580
        },
        {
            "tool": "naturalize",
            "errors": [
                {
                    "line": "311",
                    "severity": "error",
                    "message": "Line is longer than 140 characters (found 144).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "406",
                    "severity": "error",
                    "message": "Line is longer than 140 characters (found 161).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                }
            ],
            "diff": "diff --git a/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/errored/1/104/GwasAnalysis.java b/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/naturalize/104/GwasAnalysis.java\nindex b8d52ffdd39..cee6fb49678 100644\n--- a/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/errored/1/104/GwasAnalysis.java\n+++ b/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/naturalize/104/GwasAnalysis.java\n@@ -220,10 +220,9 @@ public class GwasAnalysis extends OpenCgaTool {\n                 }\n             }\n             throw new ToolException(\"Unable to run Gwas analysis with overlapping cohorts. \"\n-                    + (overlapping.size() < 10\n-                        ? \"Samples \" + overlapping + \" are shared between both cohorts.\"\n+                    + (overlapping.size() < 10 ? \"Samples \" + overlapping + \" are shared between both cohorts.\"\n                         : \"There are \" + overlapping.size() + \" overlapping samples between the cohorts.\"));\n-        }\n+    }\n \n         // check read permission\n         try {\n@@ -357,8 +356,7 @@ public class GwasAnalysis extends OpenCgaTool {\n                     query = new Query();\n                 }\n                 QueryOptions options = new QueryOptions(\n-                        QueryOptions.INCLUDE, Arrays.asList(\n-                        SampleDBAdaptor.QueryParams.ID.key(),\n+                        QueryOptions.INCLUDE, Arrays.asList(SampleDBAdaptor.QueryParams.ID.key(),\n                         SampleDBAdaptor.QueryParams.PHENOTYPES.key()));\n \n                 samples = new ArrayList<>();\n@@ -405,8 +403,7 @@ public class GwasAnalysis extends OpenCgaTool {\n     }\n \n     private void checkParamsCombination(String cohortType,\n-                                        boolean validListOfSamples, boolean validSampleQuery, boolean validCohort, boolean validPhenotype)\n-            throws ToolException {\n+                                        boolean validListOfSamples, boolean validSampleQuery, boolean validCohort, boolean validPhenotype) throws ToolException {\n         LinkedList<String> params = new LinkedList<>();\n         if (validListOfSamples) {\n             params.add(cohortType + \"CohortSamples\");\n@@ -428,4 +425,4 @@ public class GwasAnalysis extends OpenCgaTool {\n         }\n     }\n \n-}\n+}\n\\ No newline at end of file\n",
            "diff_size": 8
        },
        {
            "tool": "codebuff",
            "errors": null,
            "diff": null
        },
        {
            "tool": "styler_random",
            "errors": [
                {
                    "line": "312",
                    "severity": "error",
                    "message": "Line is longer than 140 characters (found 144).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                }
            ],
            "diff": "",
            "diff_size": 0
        },
        {
            "tool": "styler_three_grams",
            "errors": [
                {
                    "line": "312",
                    "severity": "error",
                    "message": "Line is longer than 140 characters (found 145).",
                    "source": "com.puppycrawl.tools.checkstyle.checks.sizes.LineLengthCheck"
                },
                {
                    "line": "312",
                    "column": "60",
                    "severity": "error",
                    "message": "'(' is followed by whitespace.",
                    "source": "com.puppycrawl.tools.checkstyle.checks.whitespace.ParenPadCheck"
                }
            ],
            "diff": "diff --git a/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/errored/1/104/GwasAnalysis.java b/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/styler_three_grams/104/GwasAnalysis.java\nindex b8d52ffdd39..4b9eee006a4 100644\n--- a/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/errored/1/104/GwasAnalysis.java\n+++ b/home/fernanda/mnt/fernanda/git-styler/styler/python/experiments/results/opencb-opencga/styler_three_grams/104/GwasAnalysis.java\n@@ -309,7 +309,7 @@ public class GwasAnalysis extends OpenCgaTool {\n             step(\"index\", () -> {\n                 try {\n                     VariantScoreFormatDescriptor formatDescriptor = new VariantScoreFormatDescriptor(1, 16, 15);\n-                    variantStorageManager.variantScoreLoad(study, outputFile.toUri(), indexScoreId, caseCohort, controlCohort, formatDescriptor,\n+                    variantStorageManager.variantScoreLoad( study, outputFile.toUri(), indexScoreId, caseCohort, controlCohort, formatDescriptor,\n                             executorParams, token);\n                 } catch (CatalogException | StorageEngineException e) {\n                     throw new ToolException(e);\n",
            "diff_size": 1
        }
    ],
    "repaired_by": [
        "intellij"
    ],
    "not_repaired_by": [
        "styler",
        "naturalize",
        "codebuff",
        "styler_random",
        "styler_three_grams"
    ]
}